<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Guichem Suite Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <link rel="stylesheet" href="main.css">
</head>
<body :class="{light: theme === 'light'}">
  <div id="app">
    <div v-if="showWelcome" class="welcome-overlay">
      <h1>Welcome!</h1>
      <p>This is the Guichem Suite Web.<br>It is a collection of tools for Chemical Engineering.<br> Use the toolbar above to change theme or get help.</p>
      <button @click="enterApp">Enter</button>
    </div>
    <div v-else class="flex-col-full">
      <!-- Toolbar -->
      <div class="toolbar" :class="{light: theme === 'light'}">
        <div class="menu">
          <div class="inline-block-rel">
            <button @click.stop="toggleFileMenu">File</button>
            <div class="dropdown-menu" :class="[ {show: fileMenuOpen}, {light: theme === 'light'} ]" @click.stop>
              <button @click="fileAction('New')">New</button>
              <button @click="fileAction('Open')">Open</button>
              <button @click="fileAction('Save')">Save</button>
              <button @click="fileAction('Close')">Close</button>
              <div class="dropdown-separator"></div>
              <button @click="openSettingsTab">Settings</button>
              <div class="dropdown-separator"></div>
              <button @click="fileAction('Exit')">Exit</button>
            </div>
          </div>
          <button @click="noop">Edit</button>
          <button @click="noop">View</button>
          <div class="inline-block-rel">
            <button id="helpBtn" @click.stop="toggleHelpMenu">Help</button>
            <div id="helpMenu" class="help-menu" :class="{light: theme === 'light'}" :style="{display: helpMenuOpen ? 'block' : 'none'}" @click.stop>
              <div class="margin-bottom-8">
                  <a href="https://example.com/user-manual" target="_blank" rel="noopener">User Manual</a>
                </div>
              <button @click="openAboutTab">About</button>
            </div>
          </div>
        </div>
        <button class="theme-toggle" :class="{light: theme === 'light'}" @click="toggleTheme">
          {{ theme === 'dark' ? 'ğŸŒ™ Dark' : 'ğŸŒ Light' }}
        </button>
      </div>
      <!-- Main content area with sidebar and content -->
      <div class="flex-main-content">
        <!-- Sidebar -->
        <div class="sidebar" :class="{collapsed: sidebarCollapsed}" ref="sidebar">
          <button class="sidebar-toggle" @click="toggleSidebar" :title="sidebarCollapsed ? 'Show Sidebar' : 'Hide Sidebar'">
            {{ sidebarCollapsed ? 'â—€' : 'â–¶' }}
          </button>
          <div class="sidebar-resize-handle" v-if="!sidebarCollapsed" @mousedown="startSidebarResize"></div>
          <div class="sidebar-bar sidebar-bar-flex">
            <button @click="saveFile" :disabled="!selectedFiles.length" title="Save File">
              ğŸ’¾
              <span class="tooltip">Save File</span>
            </button>
            <button @click="loadFile" title="Load File">
              ğŸ“
              <span class="tooltip">Load File</span>
            </button>
            <button @click="previewFile" :disabled="!selectedFiles.length" title="Preview File">
              ğŸ‘ï¸
              <span class="tooltip">Preview File</span>
            </button>
            <button :disabled="!selectedFiles.length" @click="deleteFile" title="Delete File">
              ğŸ—‘ï¸
              <span class="tooltip">Delete File</span>
            </button>
            <button :disabled="selectedFiles.length !== 1" @click="renameFile" title="Rename File">
              âœï¸
              <span class="tooltip">Rename File</span>
            </button>
            <button :disabled="!selectedFiles.length" @click="duplicateFile" title="Duplicate File">
              ğŸ“‹
              <span class="tooltip">Duplicate File</span>
            </button>
            <div class="order-menu-wrapper">
              <button @click="toggleOrderMenu" title="Sort Files" :disabled="!files.length">
                â†•ï¸
                <span class="tooltip">Sort Files</span>
              </button>
              <div v-if="orderMenuOpen" class="order-menu" @mouseleave="orderMenuOpen = false">
                <div @click="orderFiles('name', true)">A â†’ Z</div>
                <div @click="orderFiles('name', false)">Z â†’ A</div>
                <div @click="orderFiles('ext', true)">Ext â†‘</div>
                <div @click="orderFiles('ext', false)">Ext â†“</div>
              </div>
            </div>
          </div>
          <div class="sidebar-files"
            @dragover.prevent
            @drop.prevent="handleFileDrop"
          >
            <div
              v-for="file in files"
              :key="file.id"
              :class="['sidebar-file', {selected: isFileSelected(file)}]"
              @click="selectFile(file, $event)"
            >
              <input type="checkbox"
                :checked="isFileSelected(file)"
                @click.stop="toggleFileSelection(file)"
                :aria-label="'Select ' + file.name"
                :title="'Select ' + file.name"
                title="Select file"
              />
              <span>{{ file.name }}</span>
            </div>
            <div v-if="!files.length" class="sidebar-empty">Drop files here or use Load</div>
          </div>
          <!-- Hidden file input for loading files -->
          <input id="sidebar-file-input" ref="fileInput" type="file" class="display-none" @change="handleFileInput" title="Load file" />
        </div>
        <!-- Main content (tabs, canvas, etc) -->
        <div class="flex-main-content-inner">
          <!-- Tab Bar -->
          <div v-if="tabs.length" class="tab-bar" :class="{light: theme === 'light'}">
            <button
              v-for="(tab, idx) in tabs"
              :key="tab.id"
              class="tab"
              :class="[{active: activeTab === tab.id}, {dragging: draggingTab === idx}, { 'drag-over': dragOverTab === idx }]"
              @click="setActiveTab(tab.id)"
              draggable="true"
              @dragstart="onTabDragStart(idx, $event)"
              @dragover.prevent="onTabDragOver(idx, $event)"
              @drop.prevent="onTabDrop(idx, $event)"
              @dragend="onTabDragEnd"
            >
              {{ tab.title }}
              <span
                class="close-icon"
                title="Close tab"
                @click.stop="closeTab(tab.id)"
              >&#10005;</span>
            </button>
          </div>
          <!-- Tab Content or No Tabs Message -->
          <div v-if="tabs.length" class="tab-content scrollable-tab-content" :class="{light: theme === 'light'}">
            <component :is="tabComponent(activeTabObj)" :tab="activeTabObj" @save="onTabSave" />
          </div>
          <div v-else class="no-tabs-message">
            No tabs open.
          </div>
          <canvas id="bgCanvas"></canvas>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="./main.js"></script>
</body>
</html>